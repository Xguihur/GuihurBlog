---
title: 将域名匹配上对应网站
date:  2024/03/30
---

## 公安报备

在备案号审批通过后，除了要悬挂备案号在自己的网站首页下方，还需要到 `https://beian.mps.gov.cn/#/` 这个网站申请公安备案。

这里的流程我是看了阿里云提供的教程来走的，他的官网上面有一个名为：`备案后流程` 的文档，文档有解释为什么需要进行公安备案（只要是想在内地通过域名访问网站，不管服务器在不在境内，都需要进行公安备案）

文档指路：[公安联网备案指引](https://help.aliyun.com/zh/icp-filing/basic-icp-service/user-guide/the-public-security-network-for-the-record-information-fill-in-the-guide?spm=5176.27804673.J_9865808500.16.3d1f7365KegkOn)

![官网指引图片](http://8.134.197.161:3000/api/images/other/image-1711814653969.png)

进入公安网络备案的平台后，先进行注册，注册需要人脸认证。注册好后，进去申请 **主体** 和 **网站** ，填写信息提交资料即可。

因为有时效性，以及网上很多很好的教程，我就不多赘述。唯一要注意的是申请网站时，有一个选项是：网站是否提供互联网交互服务。我想着之后可能会加上评论功能，所以就选了 **是** ，不知道之后会不会审核流程变得麻烦。



## 备案号悬挂

备案号下来后，需要将备案号悬挂在自己的网站下面。这一步阿里云也有对应的介绍帮助用户理解，还是蛮不错的，还有通用例子来比对，赞一下阿里云！[阿里云备案号悬挂教程](https://help.aliyun.com/zh/icp-filing/support/website-to-add-the-record-number-faq?spm=5176.27804673.J_9865808500.15.3d1f7365KegkOn#section-s3c-gec-37t)

看了好久我才明白，没有什么通用的东西一键引入，实际上就是不管用什么手段，在网站中展示出这一串属于你的备案号，并且点击能够跳转到指定的备案信息查询网站即可。

因为我备案的是在广东的，所以按照阿里云的教程，在底部展示我的备案主体号就好了，非广东的是展示网站备案号，这些都能够在阿里云上查到。

::: warning 在Vuepress中悬挂备案号

这真的是太折腾了，我一开始是使用的 Vuepress 1.x 的版本，找了好多资料都没看到具体怎么悬挂。甚至加了社群。后来想了想用 2.x 重新整一下博客也不是不行，经过测试 2.x 确实是能够悬挂备案号的，就下定决心更新了！

:::

我是使用了 `vuepress-theme-reco` 这个主题，所以按照它官网的方式创建了一个新的博客项目。

**注意：** 这里有一个细节，就是之前在开发天润的需求的时候，自己看了一遍官方文档，但具体实现细节还不太明白，所以感觉这个需求无从下手。问了辉哥这种第三方的需求，他是怎么做的。然后辉哥就和我说：像这种第三方的需求，你就应该自己建一个 html 去走一遍流程，或者是demo，把基本的细节都走通了，再去应用到项目中。然后我在昨天看士博玩 React-Native 的时候，他也是自己做了个 demo 跑通了一遍流程，从开发需求到打包 app 下载到手机。所以这个经验我在这次中也运用起来了。

首先我是建了一个项目，接着本地跑起来看了看效果，测试了一下 备案号，发现可行。接着就看官方文档，从入门，到后续的更多技巧，看一点实践一点，最终把基本用得上的都实践了一遍。其中也遇到了很多坑，比如设置不生效、默认的列表配置看不懂、Navbar 看不懂等等。但随着一点点尝试，不断翻阅文档，并且对比看 vuepress 的文档，最终这些问题都迎刃而解了，也对文档更加熟悉了。

在过了一遍后，我打算先把我的基本博客搭建起来，评论、跳转源码编辑之类的功能就暂时没有提供，留给后续优化时再开发。决定了要实现哪些功能，以及文章要怎么放置和分类后，开始对 demo 进行改造！

我将网站的内容分为 **文档** 和 **博客** 两类，对应的用途写在博客中了，自己认为这样分类还是蛮不错的！而且在这个主题中，写新的文档时，除了新建 md 文件外，还需要到配置文件中添加到对应的分类。而 博客 的新增就不需要这么麻烦，在对应的分类中，新建文件后写完 md 文档后即可直接发布，在文件中配置好标题和标签、分类即可自动识别匹配！

### 相关链接

[vuepress-theme-reco 官方网站](https://vuepress-theme-reco.recoluan.com/docs/theme/frontmatter-home.html)

[vuepress 官方网站](https://v2.vuepress.vuejs.org/zh/reference/config.html)

## 博客变化欣赏

**这是之前的博客** 

![last](http://8.134.197.161:3000/api/images/other/image-1711817115481.png)

**这是现在的博客** 

![new](http://8.134.197.161:3000/api/images/other/image-1711817421939.png)

## 域名解析以及网站配置

::: tip 背景

我已经在阿里云解析好了 `www.guihurge.top` 的域名了，但是我自己的博客是放在 这个 ip 下的 非 80 端口，这时候如果要访问网站就只能用 **域名+端口** 的方式，我不想这样暴露端口，所以想进行一下优化

:::

上网搜了一下，是说直接访问域名，它会被解析成 IP ，默认端口是 80，所以如果我想直接通过域名访问网站，在 Nginx 中配置这个域名的端口是 80 就可以了。

我测试了一下，发现确实是可以的 ，设置了一下 **server_name**  和 **listen 80** ，只要开发了 80 端口，就能直接访问到域名下对应的网站内容了。

这样其实还是暴露了端口，默认80嘛。这时候如果我不想把网站放在 这个域名以及这个端口下要怎么做呢？也就是我一开始的目的。虽然我目前觉得就这样默认80就好了也没什么事，但是展开思考一下，我感觉可以这么做：

1. 依然是配置这个域名以及监听 80 端口。这样通过域名访问时能准确地走到这个 Nginx 文件；
2. 接着在 location 中配置一下 Nginx 重定向，可以重定向到 对应想要的端口中访问网站。
3. 这样实际上就是进行了一次转发，而且是客户端无感的，这样就隐藏了这个域名下面的端口。
4. 这是我的理论，没有实践不知具体是不是真的能够隐藏端口，但理论应该是成立的。

## 问题来了

我在实践中，通过 `www.guihurge.top`  这个域名，绑定 80 端口。直接访问这个域名就能打开我的博客网站。这时候我又新解析了一个域名：`xxx.guihurge.top` ，这时候的域名也是对应 80 端口，但网站中的内容是 我自己的文件上传 的网站。访问这个域名确实也是到达了文件上传的网站。

成功的那一刻，很开心，之后可以解析多个子域名对应配置多个网站了。但我又想了一下：`我在配置域名解析的时候，虽然域名是不同的，但是解析出来的都是同一个IP，它们对应的网站也都是监听 80 端口，理论上解析出来的不都是 http://IP:80 吗？为什么能真正到对应的网站呢？`

::: tip 自己猜想一下

在配置 Nginx 的时候，确实是有多个不同的域名对应的配置，并且这些配置里面对应的也都是它们各自指向的文件目录，或许是通过域名解析后，指向到对应的 Nginx 配置文件中进行路径匹配。

这就涉及到 DNS 解析域名后，走的具体路径了。*DNS 解析域名后，拿到了正确的 IP 地址，这时候去访问这个IP地址获取信息时，也许会带上对应的域名信息，用于在目标服务器中通过 `server_name` 进行对应的 Nginx 文件匹配？* 

::: 

结论和我猜的没错，这样子链路又捋顺了一点，之后涉及到这相关的概念又会更有底气了！以下是我与GPT的对话，挺简洁明了的。其中有简单对比了一下负载均衡的概念：

---

::: details 提问GPT：一
我在阿里云中，解析了两个不同的子域名，但解析出来的都是相同的ip。接着我配置了两个 nginx 文件，对应两个域名，端口都是 80 。 这两个域名对应的是 服务器中的两个不同的文件地址。理论上DNS解析出来的 url 是一模一样的，为什么能够准确地访问到对应的文件中呢？这是和 Nginx 有关，还是和 DNS 解析有关？

**答：** 
这种情况涉及到了 DNS 解析和 Nginx 服务器配置的配合。让我们分步解释：

1. DNS 解析：当你配置两个不同的子域名，在阿里云中解析到相同的IP地址时，DNS解析将这两个不同的子域名映射到了相同的服务器IP地址。这意味着无论用户输入哪个子域名，最终都将导航到相同的服务器。
2. Nginx 服务器配置：在服务器上运行着 Nginx，它作为反向代理服务器接收来自客户端的请求，并根据请求的域名进行不同的处理。通过配置两个不同的 Nginx 文件，对应不同的域名，Nginx 可以根据请求的域名将流量路由到不同的文件地址。

因此，当用户访问不同的子域名时，DNS解析将请求导航到相同的服务器IP地址，然后Nginx根据请求的域名将流量分发到相应的文件地址，从而实现了访问不同文件的目的。所以这里既涉及到了 DNS 解析，也涉及到了 Nginx 服务器的配置。

::: 

---

::: details 提问GPT：二
刚刚那个场景中，涉及到了 nginx 的负载均衡功能吗?

**答：** 
在你描述的情况中，并没有涉及到Nginx的负载均衡功能。负载均衡通常用于分发来自多个客户端的流量到多个服务器上，以提高性能和可用性。在你的情况下，虽然两个不同的子域名解析到了相同的IP地址，但请求最终仍然只会被路由到单个服务器上的两个不同文件地址。因此，并没有多个服务器参与，也就不涉及到负载均衡。

::: 

